<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/beer.min.css" rel="stylesheet">
    <script src="js/stonejs.js"></script>
    <script>window._ = Stone.gettext;</script>
    <script src="js/htmx.js"></script>
    <script src="js/alpine/cdn.min.js" defer></script>
    <script src="js/htmx.js"></script>
    <script type="module" src="js/alpine/module.cjs.min.js" defer></script>
    <script type="module" src="js/beer.min.js"></script>
    <script type="module" src="js/material-dynamic-colors.min.js"></script>
  </head>
  <body>
    <!-- The previous lines add many features that are expected in scripts using recent versions of bigbashview -->

    <div x-data="getItems()">
      <div class="field prefix round fill">
          <i class="front">search</i>
          <input x-model="search" placeholder="Pesquisar...">
      </div>
  
      <div class="categories">
          <button x-on:click="setCategory('')" class="btn">All</button>
          <button x-on:click="setCategory('Star')" class="btn">Star</button>
          <button x-on:click="setCategory('Phone')" class="btn">Phone</button>
          <button x-on:click="setCategory('Personalization')" class="btn">Personalization</button>
          <button x-on:click="setCategory('Language')" class="btn">Language</button>
          <button x-on:click="setCategory('Multimedia')" class="btn">Multimedia</button>
          <button x-on:click="setCategory('Account')" class="btn">Account</button>
          <button x-on:click="setCategory('Privacy')" class="btn">Privacy</button>
          <button x-on:click="setCategory('Server')" class="btn">Server</button>
          <button x-on:click="setCategory('Hardware')" class="btn">Hardware</button>
          <button x-on:click="setCategory('System')" class="btn">System</button>
          <button x-on:click="setCategory('Desenv')" class="btn">Desenv</button>
          <button x-on:click="setCategory('Other')" class="btn">Other</button>
          <button x-on:click="setCategory('About')" class="btn">About</button>
      </div>
  
      <div class="grid no-padding center-align middle-align">
          <template x-for="item in filteredItems">
              <div class="s12 m6 l3">
                  <a class="chip fill round vertical" x-on:click="_run(item.exec)">
                      <img :src="item.icon" alt="Item icon">
                      <div class="item-info">
                          <span x-text="item.name"></span>
                      </div>
                      <a class="tooltip bottom medium-space horizontal" x-text="item.comment">teste</a>
                  </a>
              </div>
          </template>
      </div>

  
      <script>
          function getItems() {
              return {
                  search: '',
                  categoria: '',
                  allData: [],
                  init() {
                      fetch('loop-search-json.sh')
                          .then(response => response.json())
                          .then(data => {
                              this.allData = data;
                          });
                  },
                  get filteredItems() {
                      let items = this.allData;
                      if (this.search !== '') {
                          const searchTerm = removeAccents(this.search.toLowerCase());
                          items = items.filter((item) => {
                              return removeAccents(item.name.toLowerCase()).includes(searchTerm) ||
                                  removeAccents(item.comment.toLowerCase()).includes(searchTerm);
                          });
                      }
  
                      if (this.categoria !== '') {
                          items = items.filter((item) => {
                              return removeAccents(item.category.toLowerCase()) === this.categoria.toLowerCase();
                          });
                      }

                      if (this.search == '' && this.categoria == '') {
                          items = items.filter((item) => {
                              return removeAccents(item.category.toLowerCase()) === 'star';
                          });
                      }
  
                      return items;
                  },
                  setCategory(cat) {
                      this.categoria = cat;
                  }
              };
          }
  
          function removeAccents(str) {
              return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
          }
      </script>
  </div>
  