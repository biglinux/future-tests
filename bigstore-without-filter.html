<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/beer.min.css" rel="stylesheet">
    <script src="js/stonejs.js"></script>
    <script>window._ = Stone.gettext;</script>
    <script src="js/htmx.js"></script>
    <script src="js/alpine/cdn.min.js" defer></script>
    <script src="js/htmx.js"></script>
    <script type="module" src="js/alpine/module.cjs.min.js" defer></script>
    <script type="module" src="js/beer.min.js"></script>
    <script type="module" src="js/material-dynamic-colors.min.js"></script>
  </head>
<body class="light">
<!-- The previous lines add many features that are expected in scripts using recent versions of bigbashview -->

<!-- Main container with Alpine.js data attributes -->
<div x-data="getItems()" x-init="init">

    <!-- Header section -->
    <header>
        <nav>
            <!-- Menu button -->
            <button class="circle transparent">
                <i>menu</i>
            </button>
            
            <!-- Search bar -->
            <h5 class="max center-align">
                <div class="field prefix round fill">
                    <i class="front">search</i>
                    <input x-model="search" x-on:keydown.enter="updateSearch" placeholder="Search...">
                </div>
            </h5>
        </nav>
    </header>

    <!-- Grid of items -->
    <div class="grid no-padding center-align middle-align">
        <!-- Looping through items limited by the current limit -->
        <template x-for="item in limitedItems">
            <div class="s12 m6 l3">
                <!-- Item clickable icon and info -->
                <a class="round vertical" x-on:click="_run(item.exec)">
                    <!-- <img :src="item.icon" class="extra"> -->
                    <div class="item-info">
                        <span x-text="item.package"></span>
                    </div>
                    <!-- Tooltip with item's comment -->
                    <a class="tooltip bottom medium-space horizontal" x-show="item.description" x-text="item.description"></a>
                </a>
            </div>
        </template>
    </div>

    <!-- Button to show more results -->
    <button x-show="allData.length > limit" x-on:click="showMore" class="btn">Mostrar mais</button>

    <!-- Script for Alpine.js functionality -->
    <script>
        function getItems() {
            return {
                search: '',
                selectedCategory: '',
                allData: [],
                limit: 50, // initial limit
                // Initialize function to fetch data
                init() {
                    this.updateSearch();
                },
                // Function to update the search
                updateSearch() {
                    const query = this.search ? `search_pacman_jq.sh?${this.search}` : 'search_pacman_jq.sh?firefox';
                    fetch(query)
                        .then(response => response.json())
                        .then(data => {
                            this.allData = data;
                            this.limit = 50; // reset limit when search updates
                        });
                },
                // Function to show more results
                showMore() {
                    this.limit += 50;
                },
                // Computed property to get the currently limited items
                get limitedItems() {
                    return this.allData.slice(0, this.limit);
                }
            };
        }

        // Utility function to remove accents from a string
        function removeAccents(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }
    </script>
</div>
